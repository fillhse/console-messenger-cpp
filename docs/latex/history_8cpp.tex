\doxysection{server/history.cpp File Reference}
\hypertarget{history_8cpp}{}\label{history_8cpp}\index{server/history.cpp@{server/history.cpp}}


Реализация функций для хранения и загрузки истории переписки пользователей.  


{\ttfamily \#include "{}history.\+h"{}}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$filesystem$>$}\newline
{\ttfamily \#include $<$fstream$>$}\newline
{\ttfamily \#include $<$sstream$>$}\newline
Include dependency graph for history.\+cpp\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{history_8cpp__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
std\+::string \mbox{\hyperlink{history_8cpp_a7a46f887a14f116d328ace1ca302725f}{get\+\_\+history\+\_\+filename}} (const std\+::string \&user1, const std\+::string \&user2)
\begin{DoxyCompactList}\small\item\em Построить путь к файлу истории для двух пользователей. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{history_8cpp_aab3589714c50ca1cb82633cef1ec3b1c}{ensure\+\_\+history\+\_\+folder\+\_\+exists}} ()
\begin{DoxyCompactList}\small\item\em Создать папку HISTORY, если она ещё не существует. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{history_8cpp_ae34f9f425cbaa823626b71ca0129b740}{append\+\_\+message\+\_\+to\+\_\+history}} (const std\+::string \&user1, const std\+::string \&user2, const std\+::string \&message)
\begin{DoxyCompactList}\small\item\em Добавить сообщение в конец файла истории для двух пользователей. \end{DoxyCompactList}\item 
std\+::string \mbox{\hyperlink{history_8cpp_afc2aba136cde68f180727094b3719328}{load\+\_\+history\+\_\+for\+\_\+users}} (const std\+::string \&user1, const std\+::string \&user2)
\begin{DoxyCompactList}\small\item\em Загрузить всю историю переписки между двумя пользователями. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Реализация функций для хранения и загрузки истории переписки пользователей. 

Механизм\+:
\begin{DoxyItemize}
\item История для пары пользователей хранится в файле HISTORY/history\+\_\+$<$min$>$\+\_\+$<$max$>$.\+txt, где $<$min$>$ и $<$max$>$ — идентификаторы пользователей в лексикографическом порядке.
\item При добавлении сообщения, папка HISTORY создаётся при необходимости, а сообщение дописывается в соответствующий файл.
\item При загрузке истории возвращается содержимое файла целиком или пустая строка, если файл не существует. 
\end{DoxyItemize}

Definition in file \mbox{\hyperlink{history_8cpp_source}{history.\+cpp}}.



\doxysubsection{Function Documentation}
\Hypertarget{history_8cpp_ae34f9f425cbaa823626b71ca0129b740}\label{history_8cpp_ae34f9f425cbaa823626b71ca0129b740} 
\index{history.cpp@{history.cpp}!append\_message\_to\_history@{append\_message\_to\_history}}
\index{append\_message\_to\_history@{append\_message\_to\_history}!history.cpp@{history.cpp}}
\doxysubsubsection{\texorpdfstring{append\_message\_to\_history()}{append\_message\_to\_history()}}
{\footnotesize\ttfamily void append\+\_\+message\+\_\+to\+\_\+history (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{user1,  }\item[{const std\+::string \&}]{user2,  }\item[{const std\+::string \&}]{message }\end{DoxyParamCaption})}



Добавить сообщение в конец файла истории для двух пользователей. 

Добавить сообщение в историю чата двух пользователей.

Перед записью гарантирует существование папки HISTORY.


\begin{DoxyParams}{Parameters}
{\em user1} & Идентификатор отправителя или просто один из пользователей чата. \\
\hline
{\em user2} & Идентификатор второго пользователя чата. \\
\hline
{\em message} & Текст сообщения; может содержать символ новой строки в конце. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{history_8cpp_source_l00060}{60}} of file \mbox{\hyperlink{history_8cpp_source}{history.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00062\ \ \ \ \ \mbox{\hyperlink{history_8cpp_aab3589714c50ca1cb82633cef1ec3b1c}{ensure\_history\_folder\_exists}}();}
\DoxyCodeLine{00063\ \ \ \ \ std::ofstream\ file(\mbox{\hyperlink{history_8cpp_a7a46f887a14f116d328ace1ca302725f}{get\_history\_filename}}(user1,\ user2),\ std::ios::app);}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordflow}{if}\ (file)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ file\ <<\ message;}
\DoxyCodeLine{00066\ \ \ \ \ \}}
\DoxyCodeLine{00067\ \}}

\end{DoxyCode}
\Hypertarget{history_8cpp_aab3589714c50ca1cb82633cef1ec3b1c}\label{history_8cpp_aab3589714c50ca1cb82633cef1ec3b1c} 
\index{history.cpp@{history.cpp}!ensure\_history\_folder\_exists@{ensure\_history\_folder\_exists}}
\index{ensure\_history\_folder\_exists@{ensure\_history\_folder\_exists}!history.cpp@{history.cpp}}
\doxysubsubsection{\texorpdfstring{ensure\_history\_folder\_exists()}{ensure\_history\_folder\_exists()}}
{\footnotesize\ttfamily void ensure\+\_\+history\+\_\+folder\+\_\+exists (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Создать папку HISTORY, если она ещё не существует. 

Использует std\+::filesystem\+::exists и std\+::filesystem\+::create\+\_\+directory. 

Definition at line \mbox{\hyperlink{history_8cpp_source_l00045}{45}} of file \mbox{\hyperlink{history_8cpp_source}{history.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{if}\ (!fs::exists(\textcolor{stringliteral}{"{}HISTORY"{}}))\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ fs::create\_directory(\textcolor{stringliteral}{"{}HISTORY"{}});}
\DoxyCodeLine{00048\ \ \ \ \ \}}
\DoxyCodeLine{00049\ \}}

\end{DoxyCode}
\Hypertarget{history_8cpp_a7a46f887a14f116d328ace1ca302725f}\label{history_8cpp_a7a46f887a14f116d328ace1ca302725f} 
\index{history.cpp@{history.cpp}!get\_history\_filename@{get\_history\_filename}}
\index{get\_history\_filename@{get\_history\_filename}!history.cpp@{history.cpp}}
\doxysubsubsection{\texorpdfstring{get\_history\_filename()}{get\_history\_filename()}}
{\footnotesize\ttfamily std\+::string get\+\_\+history\+\_\+filename (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{user1,  }\item[{const std\+::string \&}]{user2 }\end{DoxyParamCaption})}



Построить путь к файлу истории для двух пользователей. 

Идентификаторы упорядочиваются лексикографически и соединяются через \textquotesingle{}\+\_\+\textquotesingle{}, а затем добавляются префикс и суффикс.


\begin{DoxyParams}{Parameters}
{\em user1} & Идентификатор первого пользователя. \\
\hline
{\em user2} & Идентификатор второго пользователя. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Строка с путём к файлу истории, например "{}\+HISTORY/history\+\_\+alice\+\_\+bob.\+txt"{}. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{history_8cpp_source_l00033}{33}} of file \mbox{\hyperlink{history_8cpp_source}{history.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00034\ \ \ \ \ std::string\ u1\ =\ user1,\ u2\ =\ user2;}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordflow}{if}\ (u1\ >\ u2)}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ std::swap(u1,\ u2);}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}HISTORY/history\_"{}}\ +\ u1\ +\ \textcolor{stringliteral}{"{}\_"{}}\ +\ u2\ +\ \textcolor{stringliteral}{"{}.txt"{}};}
\DoxyCodeLine{00038\ \}}

\end{DoxyCode}
\Hypertarget{history_8cpp_afc2aba136cde68f180727094b3719328}\label{history_8cpp_afc2aba136cde68f180727094b3719328} 
\index{history.cpp@{history.cpp}!load\_history\_for\_users@{load\_history\_for\_users}}
\index{load\_history\_for\_users@{load\_history\_for\_users}!history.cpp@{history.cpp}}
\doxysubsubsection{\texorpdfstring{load\_history\_for\_users()}{load\_history\_for\_users()}}
{\footnotesize\ttfamily std\+::string load\+\_\+history\+\_\+for\+\_\+users (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{user1,  }\item[{const std\+::string \&}]{user2 }\end{DoxyParamCaption})}



Загрузить всю историю переписки между двумя пользователями. 

Если файл с историей существует, читает его содержимое через std\+::ostringstream.


\begin{DoxyParams}{Parameters}
{\em user1} & Идентификатор первого пользователя. \\
\hline
{\em user2} & Идентификатор второго пользователя. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Строка с полным содержимым файла истории; пустая строка, если файл недоступен. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{history_8cpp_source_l00078}{78}} of file \mbox{\hyperlink{history_8cpp_source}{history.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{history_8cpp_aab3589714c50ca1cb82633cef1ec3b1c}{ensure\_history\_folder\_exists}}();}
\DoxyCodeLine{00080\ \ \ \ \ std::ifstream\ file(\mbox{\hyperlink{history_8cpp_a7a46f887a14f116d328ace1ca302725f}{get\_history\_filename}}(user1,\ user2));}
\DoxyCodeLine{00081\ \ \ \ \ std::ostringstream\ ss;}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{if}\ (file)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ ss\ <<\ file.rdbuf();}
\DoxyCodeLine{00084\ \ \ \ \ \}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordflow}{return}\ ss.str();}
\DoxyCodeLine{00086\ \}}

\end{DoxyCode}
