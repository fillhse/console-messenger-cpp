\doxysection{socket\+\_\+utils.\+h File Reference}
\hypertarget{socket__utils_8h}{}\label{socket__utils_8h}\index{socket\_utils.h@{socket\_utils.h}}


Обёртки функций отправки и приёма данных по TCP-\/сокетам.  


{\ttfamily \#include $<$sys/socket.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$iostream$>$}\newline
{\ttfamily \#include $<$string$>$}\newline
{\ttfamily \#include $<$string\+\_\+view$>$}\newline
Include dependency graph for socket\+\_\+utils.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{socket__utils_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{socket__utils_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{socket__utils_8h_a03a3473dbc76b30e555485f53475de14}{send\+\_\+all}} (int fd, std\+::string\+\_\+view data)
\begin{DoxyCompactList}\small\item\em Отправить весь буфер данных через сокет. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{socket__utils_8h_ab7030e8ec8c403aa4a278f6034fa4ca5}{send\+\_\+packet}} (int fd, std\+::string\+\_\+view data)
\begin{DoxyCompactList}\small\item\em Отправить пакет текстовых данных через сокет. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{socket__utils_8h_aa746ccdea39cf6cd75d161dd1354d5e3}{send\+\_\+line}} (int fd, std\+::string\+\_\+view sv)
\begin{DoxyCompactList}\small\item\em Отправить одну строку через сокет. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{socket__utils_8h_adfb7b70bdf1ffb56b41fd4b88e8b5dab}{recv\+\_\+line}} (int fd, std\+::string \&out)
\begin{DoxyCompactList}\small\item\em Прочитать одну строку из сокета до символа новой строки. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Обёртки функций отправки и приёма данных по TCP-\/сокетам. 

Содержит inline-\/функции\+:
\begin{DoxyItemize}
\item send\+\_\+all\+: отправить весь буфер данных;
\item send\+\_\+packet\+: отправить пакет строки с маркером конца сообщения "{}\texorpdfstring{$\ast$}{*}\+ENDM\texorpdfstring{$\ast$}{*}"{};
\item send\+\_\+line\+: отправить одну строку с терминатором \textquotesingle{}~\newline
\textquotesingle{};
\item recv\+\_\+line\+: получить одну строку до символа \textquotesingle{}~\newline
\textquotesingle{}. 
\end{DoxyItemize}

Definition in file \mbox{\hyperlink{socket__utils_8h_source}{socket\+\_\+utils.\+h}}.



\doxysubsection{Function Documentation}
\Hypertarget{socket__utils_8h_adfb7b70bdf1ffb56b41fd4b88e8b5dab}\label{socket__utils_8h_adfb7b70bdf1ffb56b41fd4b88e8b5dab} 
\index{socket\_utils.h@{socket\_utils.h}!recv\_line@{recv\_line}}
\index{recv\_line@{recv\_line}!socket\_utils.h@{socket\_utils.h}}
\doxysubsubsection{\texorpdfstring{recv\_line()}{recv\_line()}}
{\footnotesize\ttfamily bool recv\+\_\+line (\begin{DoxyParamCaption}\item[{int}]{fd,  }\item[{std\+::string \&}]{out }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Прочитать одну строку из сокета до символа новой строки. 

Читает по одному символу через \+::recv() и сохраняет их в {\ttfamily out} до встречи \textquotesingle{}~\newline
\textquotesingle{}. Символ \textquotesingle{}~\newline
\textquotesingle{} не включается.


\begin{DoxyParams}{Parameters}
{\em fd} & Дескриптор сокета. \\
\hline
{\em out} & Переменная для сохранения прочитанной строки. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true если строка успешно прочитана, false при закрытии соединения или ошибке. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{socket__utils_8h_source_l00090}{90}} of file \mbox{\hyperlink{socket__utils_8h_source}{socket\+\_\+utils.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00091\ \ \ \ \ out.clear();}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordtype}{char}\ ch\{\};}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ ssize\_t\ n\ =\ ::recv(fd,\ \&ch,\ 1,\ 0);}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ <=\ 0)}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ch\ ==\ \textcolor{charliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ out.push\_back(ch);}
\DoxyCodeLine{00100\ \ \ \ \ \}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00102\ \}}

\end{DoxyCode}
\Hypertarget{socket__utils_8h_a03a3473dbc76b30e555485f53475de14}\label{socket__utils_8h_a03a3473dbc76b30e555485f53475de14} 
\index{socket\_utils.h@{socket\_utils.h}!send\_all@{send\_all}}
\index{send\_all@{send\_all}!socket\_utils.h@{socket\_utils.h}}
\doxysubsubsection{\texorpdfstring{send\_all()}{send\_all()}}
{\footnotesize\ttfamily bool send\+\_\+all (\begin{DoxyParamCaption}\item[{int}]{fd,  }\item[{std\+::string\+\_\+view}]{data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Отправить весь буфер данных через сокет. 

Использует \+::send() в цикле, пока не отправит все байты из {\ttfamily data}.


\begin{DoxyParams}{Parameters}
{\em fd} & Дескриптор сокета. \\
\hline
{\em data} & Буфер данных для отправки. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true если все данные успешно отправлены, false при ошибке. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{socket__utils_8h_source_l00031}{31}} of file \mbox{\hyperlink{socket__utils_8h_source}{socket\+\_\+utils.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00032\ \ \ \ \ std::string\ message(data);}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sent\ =\ 0;}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordflow}{while}\ (sent\ <\ message.size())\ \{}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ ssize\_t\ n\ =\ ::send(fd,\ message.data()\ +\ sent,\ message.size()\ -\/\ sent,\ 0);}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ <=\ 0)}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ sent\ +=\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(n);}
\DoxyCodeLine{00039\ \ \ \ \ \}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00041\ \}}

\end{DoxyCode}
\Hypertarget{socket__utils_8h_aa746ccdea39cf6cd75d161dd1354d5e3}\label{socket__utils_8h_aa746ccdea39cf6cd75d161dd1354d5e3} 
\index{socket\_utils.h@{socket\_utils.h}!send\_line@{send\_line}}
\index{send\_line@{send\_line}!socket\_utils.h@{socket\_utils.h}}
\doxysubsubsection{\texorpdfstring{send\_line()}{send\_line()}}
{\footnotesize\ttfamily bool send\+\_\+line (\begin{DoxyParamCaption}\item[{int}]{fd,  }\item[{std\+::string\+\_\+view}]{sv }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Отправить одну строку через сокет. 

Гарантирует наличие символа новой строки \textquotesingle{}~\newline
\textquotesingle{} в конце и отправляет через \doxylink{socket__utils_8h_a03a3473dbc76b30e555485f53475de14}{send\+\_\+all()}.


\begin{DoxyParams}{Parameters}
{\em fd} & Дескриптор сокета. \\
\hline
{\em sv} & Строка для отправки. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true если строка успешно отправлена, false при ошибке. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{socket__utils_8h_source_l00071}{71}} of file \mbox{\hyperlink{socket__utils_8h_source}{socket\+\_\+utils.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{if}\ (sv.empty()\ ||\ sv.back()\ !=\ \textcolor{charliteral}{'\(\backslash\)n'})\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ std::string\ tmp(sv);}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ tmp.push\_back(\textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{socket__utils_8h_a03a3473dbc76b30e555485f53475de14}{send\_all}}(fd,\ tmp);}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{socket__utils_8h_a03a3473dbc76b30e555485f53475de14}{send\_all}}(fd,\ sv);}
\DoxyCodeLine{00078\ \}}

\end{DoxyCode}
\Hypertarget{socket__utils_8h_ab7030e8ec8c403aa4a278f6034fa4ca5}\label{socket__utils_8h_ab7030e8ec8c403aa4a278f6034fa4ca5} 
\index{socket\_utils.h@{socket\_utils.h}!send\_packet@{send\_packet}}
\index{send\_packet@{send\_packet}!socket\_utils.h@{socket\_utils.h}}
\doxysubsubsection{\texorpdfstring{send\_packet()}{send\_packet()}}
{\footnotesize\ttfamily bool send\+\_\+packet (\begin{DoxyParamCaption}\item[{int}]{fd,  }\item[{std\+::string\+\_\+view}]{data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Отправить пакет текстовых данных через сокет. 

Добавляет \textquotesingle{}~\newline
\textquotesingle{} в конец сообщения, если его нет, затем добавляет маркер "{}\texorpdfstring{$\ast$}{*}\+ENDM\texorpdfstring{$\ast$}{*}\textbackslash{}n"{} и отправляет через \doxylink{socket__utils_8h_a03a3473dbc76b30e555485f53475de14}{send\+\_\+all()}.


\begin{DoxyParams}{Parameters}
{\em fd} & Дескриптор сокета. \\
\hline
{\em data} & Текст данных для отправки. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true если пакет успешно отправлен, false при ошибке. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{socket__utils_8h_source_l00053}{53}} of file \mbox{\hyperlink{socket__utils_8h_source}{socket\+\_\+utils.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00054\ \ \ \ \ std::string\ message(data);}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordflow}{if}\ (message.empty()\ ||\ message.back()\ !=\ \textcolor{charliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ message.push\_back(\textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{00057\ \ \ \ \ message\ +=\ \textcolor{stringliteral}{"{}*ENDM*\(\backslash\)n"{}};}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{socket__utils_8h_a03a3473dbc76b30e555485f53475de14}{send\_all}}(fd,\ message);}
\DoxyCodeLine{00059\ \}}

\end{DoxyCode}
